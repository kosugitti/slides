<!DOCTYPE html>
<html lang="en"><head>
<script src="YamaguchiR001_files/libs/clipboard/clipboard.min.js"></script>
<script src="YamaguchiR001_files/libs/quarto-html/tabby.min.js"></script>
<script src="YamaguchiR001_files/libs/quarto-html/popper.min.js"></script>
<script src="YamaguchiR001_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="YamaguchiR001_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="YamaguchiR001_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="YamaguchiR001_files/libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="YamaguchiR001_files/libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="YamaguchiR001_files/libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.42">

  <meta name="author" content="Koji Kosugi">
  <title>関数とパッケージの作り方</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="YamaguchiR001_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="YamaguchiR001_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="YamaguchiR001_files/libs/revealjs/dist/theme/quarto-930ff2c627947ef0370a337d1a02600e.css">
  <link rel="stylesheet" href="custom.css">
  <link href="YamaguchiR001_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="YamaguchiR001_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="YamaguchiR001_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="YamaguchiR001_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">関数とパッケージの作り方</h1>
  <p class="subtitle">初級から中級へのステップアップ</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="https://kosugitti.github.io/kosugitti10/">Koji Kosugi</a> 
</div>
<div class="quarto-title-author-email">
<a href="mailto:kosugitti_at_gmail.com">kosugitti_at_gmail.com</a>
</div>
        <p class="quarto-title-affiliation">
            Senshu University
          </p>
    </div>
</div>

</section>
<section id="自己紹介" class="slide level2">
<h2>自己紹介</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p>小杉考司（こすぎこうじ）</p>
<p><a href="https://github.com/kosugitti"><i class="fa-brands fa-github" aria-label="github"></i></a> <a href=""><i class="fa-brands fa-discord" aria-label="discord"></i></a> <a href=""><i class="fa-brands fa-instagram" aria-label="instagram"></i></a> <a href="https://twitter.com/kosugitti"><i class="fa-brands fa-x-twitter" aria-label="x-twitter"></i></a><span class="citation" data-cites="kosugitti">@kosugitti</span> <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewbox="0 0 24 24"> <path fill="currentColor" d="M4.907 3.44c.709.12 1.533.501 2.576 1.247C9.28 5.97 10.769 7.739 12 9.564c1.231-1.825 2.72-3.593 4.517-4.877c1.043-.746 1.867-1.127 2.576-1.248c.767-.13 1.29.065 1.615.2C21.717 4.06 22 5.225 22 6.215c0 .201-.086 1.302-.185 2.36c-.052.546-.11 1.108-.166 1.577c-.053.428-.115.88-.19 1.133a4.331 4.331 0 0 1-1.951 2.517c.937.707 1.277 1.856.928 2.984c-.597 1.924-2.737 4.397-4.835 4.618c-1.773.186-2.935-1.325-3.601-2.76c-.666 1.435-1.828 2.946-3.6 2.76c-2.099-.22-4.24-2.694-4.836-4.618c-.35-1.128-.01-2.277.928-2.984a4.331 4.331 0 0 1-1.95-2.517c-.076-.253-.138-.705-.19-1.133a60.58 60.58 0 0 1-.167-1.577C2.085 7.517 2 6.416 2 6.215c0-.99.283-2.155 1.292-2.576c.326-.135.847-.33 1.615-.2M4.05 6.916c.064.818.18 2.108.288 2.992c.032.268.055.545.122.807c.397 1.34 1.929 2.082 3.686 1.887a1 1 0 0 1 .257 1.983c-.756.112-3.315.357-2.928 1.607c.357 1.151 1.848 3.087 3.134 3.222c.928.097 1.5-1.394 1.766-2.045c.275-.674.488-1.38.668-1.982a1 1 0 0 1 1.916 0c.18.602.393 1.308.668 1.982c.266.651.838 2.142 1.766 2.045c1.286-.135 2.777-2.07 3.134-3.222c.387-1.25-2.172-1.495-2.928-1.607a1 1 0 0 1 .257-1.983c1.757.195 3.289-.547 3.686-1.887c.069-.266.089-.536.122-.807a80.35 80.35 0 0 0 .288-2.992c.037-.468.247-1.637-.522-1.506c-.286.049-.823.241-1.749.903c-1.943 1.389-3.705 3.513-4.789 5.64a1 1 0 0 1-1.782 0c-1.084-2.127-2.846-4.251-4.789-5.64c-.926-.662-1.463-.854-1.749-.903c-.784-.134-.559 1.034-.522 1.506"></path></svg><span class="citation" data-cites="kosugitti.bsky.social">@kosugitti.bsky.social</span></p>

<p><a href=""><i class="fa-brands fa-mastodon" aria-label="mastodon"></i>Kosugitti@mastdon.jp</a></p>
<p><a href="https://orcid.org/0000-0001-5816-0099"><i class="fa-brands fa-orcid" aria-label="orcid"></i>0000-0001-5816-0099</a></p>
<h3 id="略歴">略歴</h3>
<ul>
<li>1976.01.17 大阪府大阪市生まれ</li>
<li>2007.04～2018.03 山口大学教育学部に奉職
<ul>
<li>大殿のあたりに住んでました</li>
</ul></li>
<li>2018.04〜専修大学人間科学部</li>
</ul>
<h3 id="専門">専門</h3>
<ul>
<li>数理社会心理学(社会心理学＋心理統計)</li>
</ul>
<h3 id="r歴">R歴</h3>
<ul>
<li>2007年から本格利用開始</li>
</ul>
</div><div class="column" style="width:40%;">
<p>あとでじゃん献本！しましょう。</p>
<div class="r-stack">
<p><img data-src="kosBlack.jpg" class="fragment" width="450"></p>
<p><img data-src="RUMS1.jpg" class="fragment" width="450"></p>
<p><img data-src="RUMS2.jpg" class="fragment" width="450"></p>
<p><img data-src="SimBook.jpg" class="fragment" width="450"></p>
</div>
</div></div>
</section>
<section id="中級者とは何か" class="slide level2">
<h2>中級者とは何か</h2>
<p>初級者を名乗るのは簡単なことですが，どこから中級者を名乗ればいいのかは難しい。</p>
<ul>
<li>利用歴X年目から？</li>
<li>パイプ演算子を使い始めたら？</li>
</ul>
<p>個人的には，↓ぐらいが中級者のラインではないかと。ちなみに，いずれも「案ずるより産むが易し」で，やってみたら意外と簡単なステップなんです。</p>
<ul>
<li>SピーSSなど，他の統計ソフトをアンインストールした</li>
<li>関数やパッケージを作り始めた</li>
<li>Quarto/Github/Shinyなどに手を出し始めた</li>
</ul>
<p>今日は<strong>「関数とパッケージの作り方」</strong>をお話しするので，今日の話を聞き終わったら皆さんも中級者？</p>
</section>
<section id="余談quartoって" class="slide level2">
<h2>余談；Quartoって？</h2>
<h3 id="quartoとは文書作成ツールの名称">Quartoとは，文書作成ツールの名称。</h3>
<ul>
<li>マークダウンという書式をつかって，プレーンテキストに記号を書き込みながら文書を作成します。</li>
<li>HTML言語をブラウザが読める形にレイアウトするように，Quartoで書かれた文書をコンパイルしてhtmlやpdf,docx,epub,pptxなどのファイルに出力できます。</li>
<li>このスライドもQuartoを使ってhtmlに変換しています。</li>
</ul>
<h3 id="rmarkdownとどう違うの">Rmarkdownとどう違うの？</h3>
<ul>
<li>RStudioにはRmarkdownという書式があり，これも同じような仕組み。</li>
<li>RmarkdownやQuartoを使うメリットは，文書作成，統計計算，図の可視化などが一枚のファイルでできるので，別々のアプリを使って作る必要がないこと，計算プロセスなども文書に埋め込めることなどが利点。</li>
<li>QuartoはRmarkdownの上位互換で，最近Posit社が力を入れている書式であり，RだけでなくPython, Juliaなど複数の言語をサポートしているところが特徴的。</li>
</ul>
</section>
<section>
<section id="関数を作る" class="title-slide slide level1 center">
<h1>関数を作る</h1>

</section>
<section id="関数をつかう" class="slide level2">
<h2>関数をつかう</h2>
<p>関数を使うのは簡単ですね。たとえば平方根を求めたいときに，</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">sqrt</span>(<span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
</div>
<p>のように使うわけです。このとき，</p>
<ul>
<li><code>sqrt</code>は関数名</li>
<li>()で関数に渡す値は<strong>引数(ひきすう，argument)</strong></li>
<li><code>4</code>という結果は<strong>戻り値(もどりち，value)</strong></li>
</ul>
<p>といいます。</p>
</section>
<section id="関数を作る1引数がひとつのばあい" class="slide level2">
<h2>関数を作る1；引数がひとつのばあい</h2>
<p>関数を作る関数，<code>function</code>をつかって次のように関数を作ることができます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a>add2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb3-2"><a href=""></a>  tmp <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb3-3"><a href=""></a>  <span class="fu">return</span>(tmp)</span>
<span id="cb3-4"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li>関数名に<code>function</code>でつくるオブジェクトを代入します。</li>
<li>function<code>後ろの</code>()`に，その関数がとる引数名を書きます。</li>
<li>その後ろの<code>{}</code>に関数の計算・操作を書きます。複数行可。</li>
<li><code>return</code>関数に戻り値にするものを渡します</li>
</ol>
<p>これで関数<code>add2</code>ができました。使い方は他の関数と同じです。</p>
<div class="big-code">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="fu">add2</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
</div>
<p>この関数は与えられた数字に<code>2</code>を足して返すだけ挙動ですが，うまく動いてますね！</p>
</section>
<section id="関数を作る2引数がふたつのばあい" class="slide level2">
<h2>関数を作る2；引数がふたつのばあい</h2>
<p>さっきの関数は引数がひとつだけでした。複数指定するときは，<code>()</code>のなかに並べて書きます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>plus <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb6-2"><a href=""></a>  tmp <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb6-3"><a href=""></a>  <span class="fu">return</span>(tmp)</span>
<span id="cb6-4"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>この関数は2つの引数を取り，加えた値を返します。</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a><span class="fu">plus</span>(<span class="dv">2</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6</code></pre>
</div>
</div>
<ul>
<li>引数を指定してやれば，順番を入れ替えてもOKです。逆にいうと，引数名の指定がなければ前から順に適用されていきます。</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a><span class="fu">plus</span>(<span class="at">y =</span> <span class="dv">3</span>, <span class="at">x =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
</section>
<section id="関数を作る3デフォルトの設定" class="slide level2">
<h2>関数を作る3；デフォルトの設定</h2>
<p>関数を作る時に，引数に値を渡しておくと，それがデフォルトの値になります。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>plus2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">2</span>) {</span>
<span id="cb11-2"><a href=""></a>  tmp <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb11-3"><a href=""></a>  <span class="fu">return</span>(tmp)</span>
<span id="cb11-4"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>デフォルトの値があると，指定しなくてもその値が利用されます。</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="fu">plus2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="fu">plus2</span>(<span class="at">x =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="fu">plus2</span>(<span class="at">y =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<ul>
<li>皆さんが今まで使っていた関数も，デフォルトで色々決まっていることがあります。</li>
<li>ヘルプを見ると，どういう引数オプションがあるのかわかります。一度見ておくと，理解がいっそう深まりますよ〜<span class="emoji" data-emoji="smiley">😃</span></li>
</ul>
</section>
<section id="関数を作る4注意点スコープ" class="slide level2">
<h2>関数を作る4；注意点(スコープ)</h2>
<p>関数の中で作った・使ったオブジェクトは，関数の外から参照できません。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a>minus <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="dv">3</span>, <span class="at">y =</span> <span class="dv">2</span>) {</span>
<span id="cb18-2"><a href=""></a>  tmp <span class="ot">&lt;-</span> x <span class="sc">-</span> y</span>
<span id="cb18-3"><a href=""></a>  <span class="fu">return</span>(tmp)</span>
<span id="cb18-4"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>これに続けて，関数の中でつかっていた一時オブジェクト<code>tmp</code>を参照してみましょう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a>tmp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<pre><code>Error:

!  オブジェクト 'tmp' がありません 

 実行が停止されました </code></pre>
<p><br> Oh…! <span class="emoji" data-emoji="scream">😱</span></p>
</section>
<section id="スコープのひみつ" class="slide level2">
<h2>スコープのひみつ</h2>
<div class="columns">
<div class="column" style="width:60%;">
<ul>
<li><p>関数の中で使った変数は関数の外で使えないというのは，不便に思えますが，実は親切設計。</p></li>
<li><p>関数の中で閉じている・まとまっていることで，オブジェクトがあちこちで上書きされたりすることがなくなります</p></li>
<li><p>変数がどこまで効いているかという概念を「スコープ」と言いますが，これができるまでのプログラミング言語(FortranとかBASICとか)は，長いコードの中で変数名がごっちゃになることがありました。</p></li>
<li><p>歴史的経緯で，「どこからでも変数名が見える」状態から，「全体で利用できる変数(グローバル変数)と，関数の中だけて使える変数(ローカル変数)にわける」状態へ，そして「もう全部関数の中に閉じ込めちゃえよ」となってきています。</p></li>
</ul>
</div><div class="column" style="width:40%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="spa.png"></p>
<figcaption>スパゲティコード by chatGPTv4</figcaption>
</figure>
</div>
</div></div>
</section>
<section id="rは再利用する" class="slide level2">
<h2>Rは再利用する</h2>
<p>しかし，Rは関数の中で見つからない変数があれば，環境変数を再利用します！ちょっとコワイ。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a><span class="co"># 関数の前に用意する</span></span>
<span id="cb21-2"><a href=""></a>pre_tmp <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb21-3"><a href=""></a><span class="co"># 関数を作る</span></span>
<span id="cb21-4"><a href=""></a>myFunc <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb21-5"><a href=""></a>    tmp <span class="ot">&lt;-</span> x <span class="sc">+</span> pre_tmp</span>
<span id="cb21-6"><a href=""></a>    pre_tmp <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb21-7"><a href=""></a>    <span class="fu">return</span>(tmp)</span>
<span id="cb21-8"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>注目ポイントは，次の3点です。</p>
<ul>
<li><code>pre_tmp</code>はこの関数<code>myFunc</code>の引数ではない。</li>
<li><code>pre_tmp</code>はこの関数の中で違う数字を割り当てられている。</li>
<li>この関数が返すのは<code>tmp</code>だけである。</li>
</ul>
</section>
<section id="これを使ってみるとおかしなことが起きるよ" class="slide level2">
<h2>これを使ってみると，おかしなことが起きるよ。</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a><span class="co"># 関数を使う</span></span>
<span id="cb22-2"><a href=""></a><span class="fu">myFunc</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a><span class="co"># 関数の中で加えられた変更は効いてない</span></span>
<span id="cb24-2"><a href=""></a>pre_tmp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<p>Rはこのように「再利用癖」があるので，注意しましょう。</p>
<p>関数を作るときは， <strong>関数の中で使う変数は全て引数に指定する</strong>ことを心がけた方が良いかも。</p>
</section>
<section id="関数を作る5複数の戻り値" class="slide level2">
<h2>関数を作る5；複数の戻り値</h2>
<p>Rの関数が返すオブジェクトは一つだけ。もし複数の値を返したいのなら，<code>list</code>でまとめよう。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a>calcs <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y){</span>
<span id="cb26-2"><a href=""></a>    pl <span class="ot">&lt;-</span> x <span class="sc">+</span> y</span>
<span id="cb26-3"><a href=""></a>    mi <span class="ot">&lt;-</span> x<span class="sc">-</span>y</span>
<span id="cb26-4"><a href=""></a>    pr <span class="ot">&lt;-</span> x<span class="sc">*</span>y</span>
<span id="cb26-5"><a href=""></a>    di <span class="ot">&lt;-</span> x<span class="sc">/</span>y</span>
<span id="cb26-6"><a href=""></a>    tmp <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">plus =</span> pl, <span class="at">minus =</span> mi, <span class="at">prod =</span> pr, <span class="at">divide =</span> di )</span>
<span id="cb26-7"><a href=""></a>    <span class="fu">return</span>(tmp)</span>
<span id="cb26-8"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>使い方の例；</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a>return <span class="ot">&lt;-</span> <span class="fu">calcs</span>(<span class="at">x=</span><span class="dv">10</span>,<span class="at">y=</span><span class="dv">2</span>)</span>
<span id="cb27-2"><a href=""></a><span class="co"># </span></span>
<span id="cb27-3"><a href=""></a>return<span class="sc">$</span>plus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a>return<span class="sc">$</span>divide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
</section>
<section id="hands-on時間調整と休憩" class="slide level2">
<h2>Hands-on!(時間調整と休憩)</h2>
<p>こんな感じで関数が作れます！色々作ってみよう。</p>
<ul>
<li>Rには不偏分散を計算する<code>var</code>はあるけど標本分散を計算する関数はないよ。作ってみよう！</li>
<li>同じコードを3回書いたら，関数化することを考えよう！</li>
</ul>
<h3 id="関数を作るメリット">関数を作るメリット</h3>
<ul>
<li>再利用性；同じ関数を他のプログラムでも再利用できます。</li>
<li>モジュール性；プログラムを管理しやすい部分に分割できます。</li>
<li>保全性；部分に分割できているので，バグが見つけやすく，メンテナンスしやすくなります。</li>
</ul>
<p>そしてたくさん関数を書いたら・・・・</p>
</section></section>
<section>
<section id="パッケージを作ってみよう" class="title-slide slide level1 center">
<h1>パッケージを作ってみよう！</h1>

</section>
<section id="パッケージを使う" class="slide level2">
<h2>パッケージを使う</h2>
<h3 id="パッケージを使うのは割と敷居が低い">パッケージを「使う」のは割と敷居が低い</h3>
<p>Rではデフォルトで持っているパッケージでも一通りの計算ができるが，より便利に・より専門的に使うためにはパッケージの導入は必須。</p>
<p>(心理統計で)よく使うパッケージとしては次のようなものが</p>
<ul>
<li>tidyverse</li>
<li>psych</li>
<li>rstan/cmdstanr</li>
</ul>
<p>これらは<code>library</code>関数で呼び出すことができる。欲しいパッケージはインターネットからとってくることができる。</p>
<ul>
<li>install.packages関数でインストール</li>
<li>update.packages関数で一括アップデート</li>
<li>RStudioのPacagesタブでGUI操作も！</li>
</ul>
</section>
<section id="あなたのパッケージはどこから" class="slide level2">
<h2>あなたのパッケージはどこから?</h2>
<ul>
<li>一般的には，<strong>CRAN(The Comprehensive R Archive Network)</strong>という書庫ネットワークからダウンロードする(している)。 <img data-src="CRAN.png" alt="CRAN一覧"></li>
<li>古いパッケージでもはやCRANに載っていない，というときはアーカイブや作者のサイトからファイルをダウンロードしたりする。ちなみに，パッケージは複数のファイルをまとめて<code>.tar.gz</code>形式で圧縮されています。
<ul>
<li>→.tar.gzはUnix系の圧縮方法で，tarで複数のファイルを一つにまとめ，gzipで圧縮するという2段階ステップを経ているのでこんな感じの拡張子になる。</li>
</ul></li>
<li>最近はGithubをつかって公開されていることも多く，<code>devtools</code>パッケージを使ってダウンロードすることができる。</li>
</ul>
</section>
<section id="余談githubって" class="slide level2">
<h2>(余談)Githubって？</h2>
<ul>
<li>GithubはGitというシステムをインターネットをHubとして使うようにしたもの。</li>
<li>Gitはバージョン管理システムのこと</li>
<li><img data-src="branch.png"></li>
<li>commitとは保存と同じような意味。ファイル構造やファイルの差分を記録していくこと。</li>
<li>幹の部分をいきなり変更するのではなく，枝葉で修正を加えて，「よーしこれで！」という時に幹をアップデートする仕組み。</li>
</ul>
</section>
<section id="余談githubってその2" class="slide level2">
<h2>(余談)Githubって？(その2)</h2>
<ul>
<li>さっきのcommit/pull requestをネット上でやる。</li>
<li>Githubというサイトにファイルを保存する場所(レポジトリ)を作ってやり取り。</li>
<li>ネットに挙げる(push)，ネットから最新版を取ってくる(pull)という作業が含まれる。 -</li>
<li><img data-src="github.png"></li>
</ul>
</section>
<section id="余談githubってその3" class="slide level2">
<h2>(余談)Githubって？(その3)</h2>
<h3 id="githubのメリット">Githubのメリット</h3>
<ul>
<li>複数チームによる並列的な開発に貢献！
<ul>
<li>もとはLinuxの開発システム</li>
<li>個人で使ってもなんら問題ない。</li>
<li>文系のひとが使うことにもメリットが(作文・執筆)
<ul>
<li>卒論の執筆状況の管理・バックアップに使える！指導教員も安心</li>
</ul></li>
</ul></li>
</ul>
<h3 id="githubの便利機能">Githubの便利機能</h3>
<ul>
<li>Github PagesというWebサイトを作ることも
<ul>
<li>パッケージ/ソフトウェアの開発と公開が同時に進められる
<ul>
<li>随時Bug Fixができる</li>
<li>CRANへの登録は審査があって時間がかかるので，最近はこちらで野良パッケージを公開する人も多い</li>
</ul></li>
<li>Webサイトの書き方はRmd/Quartoでカンタン</li>
<li>RStudioと連携できる</li>
</ul></li>
</ul>
</section>
<section id="宣伝" class="slide level2">
<h2>宣伝</h2>
<p><a href="https://kosugitti.github.io/Exametrika/" class="uri">https://kosugitti.github.io/Exametrika/</a></p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Readme.mdが自動的にサイト化される <img data-src="Exametrika1.png" class="quarto-figure quarto-figure-center"></p>
</div><div class="column" style="width:50%;">
<p>Githubのレポジトリはこんな感じ <img data-src="Exametrika2.png"></p>
</div></div>
<p><img data-src="Exametrika_install.png"></p>
</section>
<section id="パッケージを作ってみよう-1" class="slide level2">
<h2>パッケージを作ってみよう</h2>
<p>パッケージには関数，データセット，ヘルプファイルが含まれますが・・・</p>
<h3 id="パッケージを自作するメリット">パッケージを自作するメリット</h3>
<ul>
<li>勉強になる！
<ul>
<li>統計モデルは数式で説明されて，使う時は関数の使い方を学ぶ
<ul>
<li>解説と実践の間に乖離があると思いません？</li>
<li>数式の解説って，式展開を追うだけでわかりますか？数値で確認したくない？</li>
</ul></li>
</ul></li>
<li>再利用ができるようになる！
<ul>
<li>同じコードを3回書いたら関数化しよう。</li>
<li>いつも書く自分のコードは書いて保存しておこう</li>
<li>ヘルプファイルで自分への記録に</li>
</ul></li>
<li>共有しよう
<ul>
<li>データセットも関数も，まとめて<code>library(MyPackage)</code></li>
<li>最初に書いた自作パッケージは科研のもの
<ul>
<li>データセットとよく使うコードをパッケージングして共同研究者とシェア</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="パッケージを作る環境はずいぶんと整っています" class="slide level2">
<h2>パッケージを作る環境はずいぶんと整っています！</h2>
<ul>
<li>RStudioがプロジェクトをパッケージ作成仕様にしてくれる</li>
<li>devtools,usethis,roxygen2など，パッケージを手助けしてくれるパッケージが
<ul>
<li><code>devtools</code>はスケルトン，チェック，ビルドなどを手助けしてくれる</li>
<li><code>usethis</code>は初期設定などをカンタンにしてくれる</li>
<li><code>roxygen2</code>はヘルプファイルを自動的に作ってくれる</li>
</ul></li>
<li>Githubと連携すれば公開サイトを作るのもカンタン</li>
</ul>
<p><img data-src="RStudio.png" style="width:24.0%"> <img data-src="devtools.png" style="width:24.0%"> <img data-src="usethis.png" style="width:24.0%"> <img data-src="roxygen2.png" style="width:24.0%"></p>
</section>
<section id="やってみようその1" class="slide level2">
<h2>やってみよう(その1)</h2>
<p>まずは新しいプロジェクトから</p>
<div class="r-stack">
<p><img data-src="step1.png" class="fragment" width="2000"></p>
<p><img data-src="step2.png" class="fragment" width="1600"></p>
<p><img data-src="step3.png" class="fragment" width="1200"></p>
<p><img data-src="step4.png" class="fragment" width="1200"></p>
</div>
</section>
<section id="やってみようその2" class="slide level2">
<h2>やってみよう(その2)</h2>

<img data-src="step5.png" class="r-stretch"><p>サンプルコード<code>hello.R</code>というのが表示されていると思います。 Filesタブを見ると，他にもNAMESPACE，DESCRIPTION，manフォルダ，Rフォルダがあるのがわかります。 (<code>.Rproj</code>はプロジェクトファイル，<code>.Rbuildignore</code>はプロジェクト関係なので一旦無視)</p>
</section>
<section id="やってみようその3しっておこう" class="slide level2">
<h2>やってみよう(その3)；しっておこう</h2>
<ul>
<li>パッケージのフォルダは<code>R</code>,<code>man</code>,<code>data</code>,<code>inst</code>,<code>tests</code>からなる
<ul>
<li><code>R</code>フォルダにRのコードを書きます</li>
<li><code>man</code>フォルダにヘルプファイルを入れますが，<code>roxygen2</code> が<strong>自動生成する</strong>ので気にする必要なし！</li>
<li><code>data</code>フォルダにパッケージと共に共有するデータを入れます。</li>
<li><code>inst</code>はその他のメタデータ，<code>tests</code>は検証テストコードなどを入れます。</li>
<li>個人的には<code>develop</code>フォルダをつくって下書きのコードを入れておきます。</li>
</ul></li>
<li>フォルダの外にはDESCRIPTIONとNAMESPACEが
<ul>
<li>DESCRIPTIONはパッケージの説明(著者名，連絡先，ライセンス，依存パッケージなど)を書きます。あとで見てみましょう。</li>
<li>NAMESPACEは<strong>自動生成されるので</strong> 手をつける必要なし！
<ul>
<li>名前空間といって，パッケージがもつ関数名のリストなどが入ります。同じ関数名があると上書きしちゃうよ，という警告を出すために必要。</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="やってみようその4" class="slide level2">
<h2>やってみよう(その4)</h2>
<p>BuildタブのConfigure Build Tools…をクリックし，<strong>自動生成</strong>(ラクチン！)してくれるための設定をしておこう。</p>
<div class="r-stack">
<p><img data-src="step6.png" class="fragment" width="1000"></p>
<p><img data-src="step7.png" class="fragment" width="1000"></p>
</div>
</section>
<section id="やってみようその5名前空間は大事" class="slide level2">
<h2>やってみよう(その5)；名前空間は大事！</h2>
<h3 id="名前空間をroxygen管理下に">名前空間をRoxygen管理下に</h3>
<p>NAMESPACEはパッケージが使う関数名を書くところなので，自分で作らないのが基本。 でも<code>Roxygen</code>で自動生成するためには，すでに存在しているNAMESPACEが<code>Roxygen</code>で作られたものでなければならないので，最初のNAMESPACEは削除しておこう。</p>
<p>あるいは， <code>usethis::use_namespace()</code>で上書きしても良い。</p>

<img data-src="step8.png" class="r-stretch"><p>開いた時に「このドキュメントは読むの専門だぞ(書き込んじゃダメだぞ)」，<code>roxygen2</code>によって作られました，と書いてあればOK。以後自動的に書き加えられていきます。</p>
</section>
<section id="やってみようその6お品書きから" class="slide level2">
<h2>やってみよう(その6)；お品書きから</h2>
<p>次はDESCRIPTIONの編集。これは手書きで。</p>
<ul>
<li><code>Title</code>; パッケージ名</li>
<li><code>Author</code>; 作者名</li>
<li><code>Maintainer</code>；保全・管理する人。</li>
<li><code>Description</code>; 説明書</li>
</ul>
<p>※英語です！chatGPT先生に翻訳してもらおう！</p>

<img data-src="step9.png" data-hight="80%" class="r-stretch"></section>
<section id="ほんまなんでもやってくれますな" class="slide level2">
<h2>ほんまなんでもやってくれますな</h2>

<img data-src="step10.png" class="quarto-figure quarto-figure-center r-stretch" style="width:150.0%"></section>
<section id="やってみようその7usethisパッケージの力を借りて" class="slide level2">
<h2>やってみよう(その7)；usethisパッケージの力を借りて</h2>
<h3 id="ライセンスの追加">ライセンスの追加</h3>
<p>パッケージを公開する時の権利関係を明記しておきましょう。 <code>usethis</code>パッケージにはいろいろなライセンスが用意されており，名前だけでうまくやってくれるようになっています。</p>
<ul>
<li><p><code>use_mit_license</code>；短くて理解しやすいライセンス。このライセンスでは，誰でもコードを変更し配布することを許可しているが，下のライセンスと著作権表示は保持されるというもの。</p></li>
<li><p><code>use_gpl3_license</code>；GPLは「ソフトウェアを使う自由」「変更する自由」「ソフトウェアを共有する自由」「変更を共有する自由」をうたう<strong>フリーソフトウェア</strong>の精神。R自体がGPLに基づいています。</p></li>
<li><p><code>use_apl2_licence</code>；アパッチ(Apache)ライセンスは，Apacheソフトウェア財団が公開し ているもので，商用利用や改変ができるライセンス。</p></li>
<li><p><img data-src="step11.png"></p></li>
</ul>
</section>
<section id="追加されたライセンス" class="slide level2">
<h2>追加されたライセンス</h2>
<p>LICENSE.mdファイルが自動的に追加される。</p>

<img data-src="license.png" class="quarto-figure quarto-figure-center r-stretch"></section>
<section id="やってみようその8usethisパッケージの力を借りてpart2" class="slide level2">
<h2>やってみよう(その8)；usethisパッケージの力を借りてpart2</h2>
<p>Roxygenで自動生成してくれるのは，ヘルプだけでなくREADME.Rmdも。</p>

<img data-src="step12.png" class="r-stretch"><p><strong>README</strong>とは，「まずこれを読んでね」という最初の説明書ファイル。Rmd書式で準備すると，Githubで公開する時の表紙になる。便利！</p>
</section>
<section id="readme.rmdより" class="slide level2">
<h2>README.Rmdより</h2>
<p>これが自動的に用意されます！ <img data-src="README.png" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</section>
<section id="コードを書きながらヘルプを書くroxygenの書き方" class="slide level2">
<h2>コードを書きながらヘルプを書く；Roxygenの書き方</h2>
<p>あとは関数をバリバリ書いていくだけ。ここでヘルプを自動的に作ってもらうために，関数の前に<code>Roxygenコメント</code>を用意しよう。</p>
<p><code>Roxygenコメント</code>は<code>#'</code>から始めることでただのコメントアウトじゃないよ，ということを表現。続く<code>@XXX</code> でヘルプのどこに何を表示させるかを書きます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href=""></a><span class="co">#' @title 関数名</span></span>
<span id="cb31-2"><a href=""></a><span class="co">#' @author 関数の作者名。必要なら。</span></span>
<span id="cb31-3"><a href=""></a><span class="co">#' @description 関数の説明</span></span>
<span id="cb31-4"><a href=""></a><span class="co">#' @details さらに詳しい説明</span></span>
<span id="cb31-5"><a href=""></a><span class="co">#' @note descriptionに書くほどではないことを書くならこちら</span></span>
<span id="cb31-6"><a href=""></a><span class="co">#' @importFrom 関数の中で他のパッケージから引用した関数を使うときは，全てここに書く</span></span>
<span id="cb31-7"><a href=""></a><span class="co">#' @param この関数が取る引数を書く</span></span>
<span id="cb31-8"><a href=""></a><span class="co">#' @return この関数が返す値を書く</span></span>
<span id="cb31-9"><a href=""></a><span class="co">#' @export この関数をユーザが使ってほしい時は，必ずこのコマンドが必要</span></span>
<span id="cb31-10"><a href=""></a><span class="co">#' @reference 参考資料や引用文献を\url{}などで記載</span></span>
<span id="cb31-11"><a href=""></a><span class="co">#' @examples 関数の使用例を書く</span></span>
<span id="cb31-12"><a href=""></a><span class="co">#' @seealso 他のドキュメントやウェブサイトへのリンクをかく。</span></span>
<span id="cb31-13"><a href=""></a><span class="co">#' @seealso[function()]など</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>@title</code>,<code>@description</code>はまあ書きましょう。</li>
<li><code>@importFrom</code>は忘れがち！でも忘れてたらコンパイル時にエラーで教えてくれるのでダイジョブ</li>
<li><code>@export</code>を忘れると，コンパイルしても「ユーザが使えない関数」になっちゃう。そんなのいるの？と思うかもしれないけど，内部だけの処理で直接ユーザに触って欲しくない関数を書くこともあるので・・・</li>
</ul>
</section>
<section id="check-and-build" class="slide level2">
<h2>Check and Build</h2>
<p>物は試し。やってみましょう。<code>R/hello.R</code>, <code>man/hello.Rd</code>を消して，関数を書きます！</p>
<div class="r-stack">
<p><img data-src="step13.png" class="fragment" width="1200"></p>
<p><img data-src="step14.png" class="fragment" width="1200"></p>
<p><img data-src="step15.png" class="fragment" width="1600"></p>
<p><img data-src="step16.png" class="fragment" width="1200"></p>
</div>
</section>
<section id="error-warning" class="slide level2">
<h2>ERROR! WARNING!</h2>

<img data-src="step17.png" class="r-stretch"><ul>
<li><p>エラーや警告はつきもの！おそれないでね。むしろこれをひとつずつ潰していくのが快感・・・<svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewbox="0 0 24 24"><path fill="currentColor" d="M12 3a9 9 0 1 0 0 18a9 9 0 0 0 0-18M1 12C1 5.925 5.925 1 12 1s11 4.925 11 11s-4.925 11-11 11S1 18.075 1 12m9.233-2.134l-3.464 2l-1-1.732l3.464-2zm4.536-1.732l3.464 2l-1 1.732l-3.464-2zm-5.869 5.5l.5.865C9.922 15.4 10.89 16 12 16s2.08-.601 2.6-1.5l.5-.866l1.731 1.001l-.5.866A4.998 4.998 0 0 1 12 18a4.998 4.998 0 0 1-4.33-2.5l-.501-.865z"></path></svg></p></li>
<li><p>先ほどの関数，引数<code>x</code>をとっていたのに，<code>@param</code>の設定がなかったことが問題で警告が出ています。</p></li>
</ul>
</section>
<section id="エラーも警告もない世界" class="slide level2">
<h2>エラーも警告もない世界</h2>
<ul>
<li>ちゃんと<code>@param</code>を書きました。</li>
<li>もちろん<code>@export</code>もね！</li>
</ul>

<img data-src="step18.png" class="r-stretch"></section>
<section id="ヘルプができてる" class="slide level2">
<h2>ヘルプができてる</h2>
<div class="r-stack">
<p><img data-src="step19.png" class="fragment" width="1600"></p>
<p><img data-src="step20.png" class="fragment" width="1600"></p>
</div>
</section>
<section id="俺たちの戦いはまだ始まったばかりだ完" class="slide level2">
<h2>俺たちの戦いはまだ始まったばかりだ(完)</h2>
<ul>
<li>ここからはもう，地道な作業。コードを書いて，マニュアル書いて，チェックして，警告やエラーをつぶす，の繰り返し。隙間時間にちょこちょこ書き進めていこう。</li>
</ul>
<h3 id="落穂拾い">落穂拾い</h3>
<ul>
<li>パッケージに同梱するデータは<code>save</code>関数をつかって<code>.rda</code>形式にし，<code>data</code>フォルダに入れる。</li>
<li>他のパッケージになるべく依存しないパッケージの方が美しい気がする。けどどうしても必要な場合は次の2点に注意
<ul>
<li><code>Roxygenコメント</code>で<code>@importFrom</code>を忘れずに。</li>
<li><img data-src="importFrom.png"></li>
<li>DESCRIPTIONに<code>Depends:</code> として外部からとってくるパッケージを書こう(手動)</li>
<li><img data-src="depends.png"></li>
</ul></li>
</ul>
</section>
<section id="落穂拾い追加" class="slide level2">
<h2>落穂拾い(追加)</h2>
<ul>
<li><code>DESCRIPTION</code>は手動で修正していく。<code>Version</code>はお気持ち次第。
<ul>
<li><a href="https://semver.org/lang/ja/">セマンティックバージョニング 2.0</a>では、ピリオドで区切られた数字はそれぞれメジャー、マイナー、パッチバージョンを表す。</li>
<li>大きな機能の修正はメジャーリビジョン，関数の追加などはマイナーバージョン，バグ修正などはパッチバージョンかな。</li>
</ul></li>
<li><code>usethis::use_news_md()</code>をつかうと<code>NEWS.md</code>ファイルを作ることができる。要するにバージョンが上がった時に何が変わったか，を記録するところ。</li>
<li><code>testthat</code>をつかうと検証用コードを書くことができて，「新しい環境にこのパッケージを入れたらちゃんと動くかな？」を確認できる。</li>
<li><code>devtools::build()</code>で<code>.tar.gz</code>ファイルができるので，これでファイルとして共有できる。インストールは<code>install.packages(ファイル名, repos = NULL, type = "source")</code>で。RStudioのGUI経由のほうが楽かも。</li>
<li><code>hexSticker</code>パッケージを使うと，六角形の例のかっこいいシールが作れたりします！</li>
</ul>
</section></section>
<section id="enjoy" class="title-slide slide level1 center">
<h1>Enjoy!</h1>

</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Yamaguchi.R Advanced Session</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="YamaguchiR001_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="YamaguchiR001_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="YamaguchiR001_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="YamaguchiR001_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="YamaguchiR001_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="YamaguchiR001_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="YamaguchiR001_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="YamaguchiR001_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="YamaguchiR001_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="YamaguchiR001_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 1200,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>